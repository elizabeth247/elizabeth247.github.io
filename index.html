<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<script src="https://d3js.org/d3.v5.min.js"></script>
</head>
<body>
<p>Hello world</p>


<script>
    //Width and height of map
    var width = 960;
    var height = 500;

    // D3 Projection
    var projection = d3.geoAlbersUsa()
        .translate([width/2, height/2])    // translate to center of screen
        .scale([1000]);          // scale things down so see entire US

    // Define path generator
    var path = d3.geoPath(projection);

    // Define linear scale for output
    var color = d3.scaleLinear()
        .range(["rgb(213,222,217)","rgb(69,173,168)","rgb(84,36,55)","rgb(217,91,67)"]);

    //Create SVG element and append map to the SVG
    var svg = d3.select("body")
        .append("svg")
        .attr("width", width)
        .attr("height", height);

    // Append Div for tooltip to SVG
    var div = d3.select("body")
        .append("div")
        .attr("class", "tooltip")
        .style("opacity", 0);

    console.log("load us states");
    // Load GeoJSON data and merge with states data
    d3.json("us-states.json").then(function(json) {
// Bind the data to the SVG and create one path per GeoJSON feature
        svg.selectAll("path")
            .data(json.features)
            .enter()
            .append("path")
            .attr("d", path)
            .style("stroke", "#fff")
            .style("stroke-width", "1")
            .style("fill", function(d) {
                return "rgb(213,222,217)";
            });


// Map the cities I have lived in!
            d3.csv("26citiesWithLatitudeLongitude.csv").then(function(data) {
                d3.json("cityPrices.json").then(function(json){
                    for (var i = 0; i < data.length; i++) {
                        var city = data[i].City;
                        for (var j = 0; j < json.length; j++) {
                            var cityJson = json[j];
                            console.log(cityJson.name);
                            console.log(cityJson.name.split(','));
                            if (city === cityJson.name.split(',')[0]){
                                console.log(city);
                                console.log(cityJson.prices[0].item_name);
							}
						}
					}
				});

                svg.selectAll("circle")
                    .data(data)
                    .enter()
                    .append("circle")
                    .attr("cx", function(d) {
                        return projection([d.Longitude, d.Latitude])[0];
                    })
                    .attr("cy", function(d) {
                        return projection([d.Longitude, d.Latitude])[1];
                    })
                    .attr("r", function(d) {
                        return 5;
                    })
                    .style("fill", "rgb(217,91,67)")
                    .style("opacity", 0.85)

        // Modification of custom tooltip code provided by Malcolm Maclean, "D3 Tips and Tricks"
        // http://www.d3noob.org/2013/01/adding-tooltips-to-d3js-graph.html
//                    .on("mouseover", function(d) {
//                        div.transition()
//                            .duration(200)
//                            .style("opacity", .9);
//                        div.text(d.place)
//                            .style("left", (d3.event.pageX) + "px")
//                            .style("top", (d3.event.pageY - 28) + "px");
//                    })
//
//                    // fade out tooltip on mouse out
//                    .on("mouseout", function(d) {
//                        div.transition()
//                            .duration(500)
//                            .style("opacity", 0);
//                    });
            });
    });

</script>
</body>
</html>
